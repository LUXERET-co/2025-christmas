<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì‚ë¹… Ã— ë£©ì„¸ë › 2025 í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì´ë²¤íŠ¸ ì¶”ì²¨</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<link href="https://cdn.jsdelivr.net/gh/toss/tossface/dist/tossface.css" rel="stylesheet" type="text/css" />
<script src="https://cdn.tailwindcss.com"></script>
<link rel="icon" type="image/png" href="/assets/image/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/assets/image/favicon.svg" />
<link rel="shortcut icon" href="/assets/image/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/assets/image/apple-touch-icon.png" />
<link rel="manifest" href="/assets/image/site.webmanifest" />
<style>
  .tossface {
    font-family: Tossface;
  }
  
  body {
    font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
  }

  @keyframes slideIn {
    to {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }
  }

  @keyframes slideOut {
    to {
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.9);
    }
  }

  .winner-announcement.show {
    animation: slideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
  }

  .winner-announcement.hide {
    animation: slideOut 0.3s ease forwards;
  }

  input[type="file"]::-webkit-file-upload-button {
    background: #2a2a2a;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    color: #fff;
    cursor: pointer;
    margin-right: 12px;
    transition: all 0.2s ease;
  }

  input[type="file"]::-webkit-file-upload-button:hover {
    background: #3a3a3a;
  }

  .gold-gradient {
    background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
  }
</style>
</head>
<body class="bg-neutral-950 text-white min-h-screen">

<div class="flex gap-6 p-6 lg:p-10 max-w-7xl mx-auto justify-center">
  <!-- ë©”ì¸ ì˜ì—­ -->
  <div class="w-full max-w-2xl">
    <h1 class="text-3xl lg:text-4xl font-bold mb-12 text-center tracking-tight">
     ì‚ë¹… Ã— ë£©ì„¸ë › 2025 í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì´ë²¤íŠ¸ ì¶”ì²¨ <span class="tossface">ğŸ°</span>
    </h1>

    <!-- ì—…ë¡œë“œ ì„¹ì…˜ -->
    <div class="bg-neutral-900 border border-neutral-800 rounded-2xl p-8 mb-6 hover:border-neutral-700 transition-colors">
<label id="kstTime" class="block text-sm text-neutral-400 mb-3"></label>

<script>
function updateKST() {
  const now = new Date(); 
  const formatted = new Intl.DateTimeFormat("ko-KR", {
    timeZone: "Asia/Seoul",
    year: "numeric",
    month: "2-digit",
    day: "2-digit",
    hour: "2-digit",
    minute: "2-digit",
    second: "2-digit",
    hour12: true
  }).format(now);

  document.getElementById("kstTime").innerText = "í˜„ì¬ ì‹œê° (KST): " + formatted;
}

setInterval(updateKST, 1000);
updateKST();
</script>

      <input 
        type="file" 
        id="excelFile" 
        accept=".xlsx"
        class="w-full p-3.5 bg-neutral-950 border border-neutral-800 rounded-xl text-white text-sm cursor-pointer transition-all hover:border-neutral-700 focus:outline-none focus:ring-2 focus:ring-neutral-700"
      />
      <div class="h-4"></div>
      <button 
        id="drawBtn" 
        onclick="startDraw()"
        disabled
        class="w-full py-4 bg-white text-neutral-950 rounded-xl font-semibold text-base transition-all hover:bg-neutral-100 active:scale-[0.98] disabled:bg-neutral-800 disabled:text-neutral-600 disabled:cursor-not-allowed"
      >
        ì¶”ì²¨ ì‹œì‘
      </button>
    </div>

    <!-- ê²°ê³¼ ì˜ì—­ -->
    <div id="results" class="opacity-0 translate-y-5 transition-all duration-500"></div>
  </div>

  <!-- ì‹¤ì‹œê°„ ë¡œê·¸ íŒ¨ë„ -->
  <div class="hidden lg:block w-80">
    <div class="bg-neutral-900 border border-neutral-800 rounded-2xl p-5 sticky top-6 max-h-[calc(100vh-3rem)] flex flex-col">
      <div class="flex items-center gap-2 mb-4 pb-4 border-b border-neutral-800">
        <span class="tossface text-xl">ğŸ”</span>
        <h2 class="font-bold text-base">ì‹¤ì‹œê°„ ì¶”ì²¨ ê³¼ì •</h2>
      </div>
      <div id="liveLog" class="flex-1 overflow-y-auto text-xs text-neutral-400 leading-relaxed font-mono"></div>
    </div>
  </div>
</div>

<!-- ì˜¤ë²„ë ˆì´ -->
<div id="overlay" class="fixed inset-0 bg-black/80 opacity-0 pointer-events-none transition-opacity duration-300 z-[999]"></div>

<!-- ë‹¹ì²¨ ë°°ë„ˆ -->
<div 
  id="announcement" 
  class="winner-announcement fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white text-neutral-950 rounded-3xl p-12 text-center z-[1000] opacity-0 pointer-events-none min-w-[360px] shadow-2xl scale-75"
>
  <div class="tossface text-7xl mb-4">ğŸ‰</div>
  <div id="announcementText" class="text-2xl font-bold leading-snug"></div>
</div>

<script>
let participants = [];

function liveLog(text) {
  const box = document.getElementById('liveLog');
  const time = new Date().toLocaleTimeString();
  const entry = document.createElement('div');
  entry.className = 'mb-1.5 opacity-0 transition-opacity duration-300';
  entry.textContent = `[${time}] ${text}`;
  box.appendChild(entry);
  setTimeout(() => entry.classList.add('opacity-100'), 50);
  box.scrollTop = box.scrollHeight;
}

function maskName(name) {
  if (name.length <= 2) return name[0] + "*";
  return name[0] + "*" + name[name.length - 1];
}

function maskPhone(phone) {
  const num = phone.replace(/[^0-9]/g, "");
  if (num.length < 10) return phone;
  return num.replace(/(\d{3})(\d{4})(\d{4})/, "$1-****-$3");
}

function maskEmail(email) {
  const [id, domain] = email.split("@");
  if (!domain) return email;
  const masked = id.slice(0, 2) + "****";
  return masked + "@" + domain;
}

function maskKakao(id) {
  if (id.length <= 2) return id[0] + "*";
  return id.slice(0, 2) + "***";
}

function displayUser(p) {
  let primary = "";
  let secondary = "";

  if (p.name !== "-") {
    primary = maskName(p.name);
    if (p.phone !== "-") secondary = maskPhone(p.phone);
    else if (p.email !== "-") secondary = maskEmail(p.email);
    else if (p.kakao !== "-") secondary = maskKakao(p.kakao);
  } else if (p.phone !== "-") {
    primary = maskPhone(p.phone);
    if (p.email !== "-") secondary = maskEmail(p.email);
    else if (p.kakao !== "-") secondary = maskKakao(p.kakao);
  } else if (p.email !== "-") {
    primary = maskEmail(p.email);
    if (p.kakao !== "-") secondary = maskKakao(p.kakao);
  } else if (p.kakao !== "-") {
    primary = maskKakao(p.kakao);
  }

  return secondary ? `${primary}<br>${secondary}` : primary;
}

function getBannerName(p) {
  if (p.name !== "-") return maskName(p.name);
  if (p.phone !== "-") return maskPhone(p.phone);
  if (p.email !== "-") return maskEmail(p.email);
  if (p.kakao !== "-") return maskKakao(p.kakao);
  return "ë‹¹ì²¨ì";
}

function showAnnouncement(text) {
  return new Promise(resolve => {
    const overlay = document.getElementById('overlay');
    const announcement = document.getElementById('announcement');
    const announcementText = document.getElementById('announcementText');
    
    overlay.classList.remove('opacity-0', 'pointer-events-none');
    overlay.classList.add('opacity-100');
    
    announcementText.textContent = text + ' ë‹˜ ë‹¹ì²¨!';
    announcement.classList.add('show');
    
    setTimeout(() => {
      announcement.classList.remove('show');
      announcement.classList.add('hide');
      overlay.classList.remove('opacity-100');
      overlay.classList.add('opacity-0', 'pointer-events-none');
      
      setTimeout(() => {
        announcement.classList.remove('hide');
        resolve();
      }, 300);
    }, 1800);
  });
}

document.getElementById('excelFile').addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = function(event) {
    const data = new Uint8Array(event.target.result);
    const workbook = XLSX.read(data, { type: "array" });
    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });

    participants = rows
      .slice(1)
      .map(row => ({
        name: (row[0] || "-").toString().trim(),
        phone: (row[1] || "-").toString().trim(),
        email: (row[2] || "-").toString().trim(),
        kakao: (row[3] || "-").toString().trim()
      }))
      .filter(p => p.name !== "-" || p.phone !== "-" || p.email !== "-" || p.kakao !== "-");

    liveLog("ì—‘ì…€ íŒŒì¼ ë¡œë“œ ì™„ë£Œ");
    liveLog(`ì°¸ì—¬ì ìˆ˜: ${participants.length}ëª…`);

    document.getElementById('drawBtn').disabled = false;
  };
  
  reader.readAsArrayBuffer(file);
});

function draw(count) {
  liveLog("ë‚œìˆ˜ ì‹œë“œ ìƒì„± ì¤‘...");
  const seed = Math.floor(Math.random() * 999999999);
  liveLog(`ì‹œë“œ ê°’: ${seed}`);

  liveLog("ì°¸ì—¬ì ëª©ë¡ ì…”í”Œ ì‹œì‘");
  let arr = [...participants];

  for (let i = 0; i < 20; i++) {
    arr.sort(() => Math.random() - 0.5);
    if ((i + 1) % 5 === 0) {
      liveLog(`ì…”í”Œ ì§„í–‰: ${Math.floor((i+1)/20*100)}%`);
    }
  }

  liveLog("ì…”í”Œ ì™„ë£Œ, ë‹¹ì²¨ì ì¶”ì¶œ ì¤‘");
  return arr.slice(0, count);
}

async function startDraw() {
  if (participants.length < 5) {
    alert("ì°¸ê°€ìê°€ ìµœì†Œ 5ëª… ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
    return;
  }

  const btn = document.getElementById('drawBtn');
  const results = document.getElementById('results');
  
  btn.disabled = true;
  btn.textContent = 'ì¶”ì²¨ ì¤‘...';
  results.innerHTML = '';
  results.classList.remove('opacity-100', 'translate-y-0');
  results.classList.add('opacity-0', 'translate-y-5');

  liveLog("=== ìƒˆë¡œìš´ ì¶”ì²¨ ì‹œì‘ ===");
  liveLog("ì¶”ì²¨ ì ˆì°¨ ì´ˆê¸°í™”");

  const winners = draw(5);

  const prizes = [
    { text: 'ğŸ’ 5ë§Œì› ìƒë‹¹ ìƒí’ˆê¶Œ', isGold: true },
    { text: 'ğŸŸï¸ ì‚ë¹… 3ê°œì›” ì´ìš©ê¶Œ', isGold: false },
    { text: 'ğŸŸï¸ ì‚ë¹… 6ê°œì›” ì´ìš©ê¶Œ', isGold: false },
    { text: 'ğŸŸï¸ ë¦¬í„´ 1ê°œì›” ì´ìš©ê¶Œ', isGold: false },
    { text: 'ğŸŸï¸ ë¦¬í„´ 3ê°œì›” ì´ìš©ê¶Œ', isGold: false }
  ];

  for (let i = 0; i < winners.length; i++) {
    liveLog(`${i+1}ë²ˆì§¸ ë‹¹ì²¨ì: ${getBannerName(winners[i])}`);
    await showAnnouncement(getBannerName(winners[i]));
    await new Promise(res => setTimeout(res, 200));
  }

  results.classList.remove('opacity-0', 'translate-y-5');
  results.classList.add('opacity-100', 'translate-y-0');
  
  winners.forEach((winner, idx) => {
    const card = document.createElement('div');
    card.className = `bg-neutral-900 border ${prizes[idx].isGold ? 'border-yellow-500 gold-gradient text-neutral-950' : 'border-neutral-800'} rounded-2xl p-6 mb-3 opacity-0 translate-y-3 transition-all duration-300`;
    
    card.innerHTML = `
      <div class="font-semibold text-base mb-2 ${prizes[idx].isGold ? 'text-neutral-950' : 'text-white'}">${prizes[idx].text}</div>
      <div class="text-sm ${prizes[idx].isGold ? 'text-neutral-700' : 'text-neutral-400'} leading-relaxed">${displayUser(winner)}</div>
    `;
    results.appendChild(card);
    
    setTimeout(() => {
      card.classList.remove('opacity-0', 'translate-y-3');
      card.classList.add('opacity-100', 'translate-y-0');
    }, idx * 100);
  });

  liveLog("ì¶”ì²¨ ì¢…ë£Œ, ê²°ê³¼ ì¶œë ¥ ì™„ë£Œ");

  btn.textContent = 'ì¶”ì²¨ ì‹œì‘';
  btn.disabled = false;
}

document.getElementById('drawBtn').disabled = true;
</script>

</body>
</html>